<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Management - Video Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Navigation -->
    <nav class="bg-gray-800 border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-video text-2xl text-blue-500"></i>
                        <span class="ml-2 text-xl font-semibold">Video Editor</span>
                    </div>
                    <div class="hidden md:block ml-10">
                        <div class="flex items-baseline space-x-4">
                            <a href="/dashboard" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Dashboard</a>
                            <a href="/assets" class="bg-gray-900 text-white px-3 py-2 rounded-md text-sm font-medium">Assets</a>
                            <a href="/jobs" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Jobs</a>
                            <a href="/settings" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Settings</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8" x-data="assetsManager()">
        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-white">Asset Management</h1>
            <p class="mt-2 text-gray-400">Upload and manage intro clips, outro clips, and logos</p>
        </div>

        <!-- Upload Section -->
        <div class="bg-gray-800 shadow rounded-lg mb-8">
            <div class="px-6 py-4 border-b border-gray-700">
                <h2 class="text-xl font-semibold">Upload New Asset</h2>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Asset Type Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Asset Type</label>
                        <select x-model="uploadForm.assetType" 
                                class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="intros">Intro Clips</option>
                            <option value="outros">Outro Clips</option>
                            <option value="logos">Logos/Watermarks</option>
                        </select>
                    </div>

                    <!-- File Upload -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Select File</label>
                        <div class="relative">
                            <input type="file" 
                                   x-ref="fileInput"
                                   @change="handleFileSelect"
                                   accept="video/*,image/*"
                                   class="hidden">
                            <button @click="$refs.fileInput.click()" 
                                    class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-left text-gray-300 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <span x-text="uploadForm.selectedFile ? uploadForm.selectedFile.name : 'Choose file...'"></span>
                            </button>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">Max size: 500MB. Supported: MP4, AVI, MOV, PNG, SVG</p>
                    </div>

                    <!-- Upload Button -->
                    <div class="flex items-end">
                        <button @click="uploadAsset()" 
                                :disabled="!uploadForm.selectedFile || isUploading"
                                class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white px-4 py-2 rounded-md font-medium transition-colors">
                            <i class="fas fa-upload mr-2" x-show="!isUploading"></i>
                            <i class="fas fa-spinner fa-spin mr-2" x-show="isUploading"></i>
                            <span x-text="isUploading ? 'Uploading...' : 'Upload Asset'"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Assets Tabs -->
        <div class="bg-gray-800 shadow rounded-lg">
            <div class="border-b border-gray-700">
                <nav class="flex">
                    <button @click="activeTab = 'intros'" 
                            :class="{'border-blue-500 text-blue-500': activeTab === 'intros', 'border-transparent text-gray-400': activeTab !== 'intros'}"
                            class="py-4 px-6 border-b-2 font-medium text-sm hover:text-gray-200">
                        <i class="fas fa-play-circle mr-2"></i>
                        Intro Clips ({{ assets.intros.length }})
                    </button>
                    <button @click="activeTab = 'outros'" 
                            :class="{'border-blue-500 text-blue-500': activeTab === 'outros', 'border-transparent text-gray-400': activeTab !== 'outros'}"
                            class="py-4 px-6 border-b-2 font-medium text-sm hover:text-gray-200">
                        <i class="fas fa-stop-circle mr-2"></i>
                        Outro Clips ({{ assets.outros.length }})
                    </button>
                    <button @click="activeTab = 'logos'" 
                            :class="{'border-blue-500 text-blue-500': activeTab === 'logos', 'border-transparent text-gray-400': activeTab !== 'logos'}"
                            class="py-4 px-6 border-b-2 font-medium text-sm hover:text-gray-200">
                        <i class="fas fa-image mr-2"></i>
                        Logos ({{ assets.logos.length }})
                    </button>
                </nav>
            </div>

            <!-- Asset Lists -->
            <div class="p-6">
                <!-- Intro Clips -->
                <div x-show="activeTab === 'intros'">
                    <div x-show="assets.intros.length === 0" class="text-center py-12 text-gray-400">
                        <i class="fas fa-play-circle text-4xl mb-4"></i>
                        <p class="text-lg">No intro clips uploaded</p>
                        <p class="text-sm">Upload your first intro clip to get started</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" x-show="assets.intros.length > 0">
                        <template x-for="asset in assets.intros" :key="asset.filename">
                            <div class="bg-gray-700 rounded-lg p-4 hover:bg-gray-650 transition-colors">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex items-center">
                                        <i class="fas fa-play-circle text-blue-500 text-xl mr-3"></i>
                                        <div>
                                            <h3 class="font-medium text-white truncate" x-text="asset.filename"></h3>
                                            <p class="text-xs text-gray-400" x-text="formatFileSize(asset.size)"></p>
                                        </div>
                                    </div>
                                    <button @click="deleteAsset('intros', asset.filename)" 
                                            class="text-red-400 hover:text-red-300 p-1">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                                <div class="text-xs text-gray-500">
                                    Modified: <span x-text="formatDate(asset.modified)"></span>
                                </div>
                                <div class="mt-3 flex space-x-2">
                                    <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-medium">
                                        Preview
                                    </button>
                                    <button class="flex-1 bg-gray-600 hover:bg-gray-500 text-white px-3 py-1 rounded text-xs font-medium">
                                        Info
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Outro Clips -->
                <div x-show="activeTab === 'outros'">
                    <div x-show="assets.outros.length === 0" class="text-center py-12 text-gray-400">
                        <i class="fas fa-stop-circle text-4xl mb-4"></i>
                        <p class="text-lg">No outro clips uploaded</p>
                        <p class="text-sm">Upload your first outro clip to get started</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" x-show="assets.outros.length > 0">
                        <template x-for="asset in assets.outros" :key="asset.filename">
                            <div class="bg-gray-700 rounded-lg p-4 hover:bg-gray-650 transition-colors">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex items-center">
                                        <i class="fas fa-stop-circle text-green-500 text-xl mr-3"></i>
                                        <div>
                                            <h3 class="font-medium text-white truncate" x-text="asset.filename"></h3>
                                            <p class="text-xs text-gray-400" x-text="formatFileSize(asset.size)"></p>
                                        </div>
                                    </div>
                                    <button @click="deleteAsset('outros', asset.filename)" 
                                            class="text-red-400 hover:text-red-300 p-1">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                                <div class="text-xs text-gray-500">
                                    Modified: <span x-text="formatDate(asset.modified)"></span>
                                </div>
                                <div class="mt-3 flex space-x-2">
                                    <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-medium">
                                        Preview
                                    </button>
                                    <button class="flex-1 bg-gray-600 hover:bg-gray-500 text-white px-3 py-1 rounded text-xs font-medium">
                                        Info
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Logos -->
                <div x-show="activeTab === 'logos'">
                    <div x-show="assets.logos.length === 0" class="text-center py-12 text-gray-400">
                        <i class="fas fa-image text-4xl mb-4"></i>
                        <p class="text-lg">No logos uploaded</p>
                        <p class="text-sm">Upload your first logo or watermark</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" x-show="assets.logos.length > 0">
                        <template x-for="asset in assets.logos" :key="asset.filename">
                            <div class="bg-gray-700 rounded-lg p-4 hover:bg-gray-650 transition-colors">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex items-center">
                                        <i class="fas fa-image text-purple-500 text-xl mr-3"></i>
                                        <div>
                                            <h3 class="font-medium text-white truncate" x-text="asset.filename"></h3>
                                            <p class="text-xs text-gray-400" x-text="formatFileSize(asset.size)"></p>
                                        </div>
                                    </div>
                                    <button @click="deleteAsset('logos', asset.filename)" 
                                            class="text-red-400 hover:text-red-300 p-1">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                                <div class="text-xs text-gray-500">
                                    Modified: <span x-text="formatDate(asset.modified)"></span>
                                </div>
                                <div class="mt-3">
                                    <button class="w-full bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-medium">
                                        Preview
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert Messages -->
        <div x-show="alert.show" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-2"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 transform translate-y-0"
             x-transition:leave-end="opacity-0 transform translate-y-2"
             class="fixed bottom-4 right-4 max-w-sm w-full bg-gray-800 border rounded-lg shadow-lg z-50"
             :class="{
                'border-green-500': alert.type === 'success',
                'border-red-500': alert.type === 'error',
                'border-yellow-500': alert.type === 'warning',
                'border-blue-500': alert.type === 'info'
             }">
            <div class="p-4">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i :class="{
                            'fas fa-check-circle text-green-500': alert.type === 'success',
                            'fas fa-exclamation-circle text-red-500': alert.type === 'error',
                            'fas fa-exclamation-triangle text-yellow-500': alert.type === 'warning',
                            'fas fa-info-circle text-blue-500': alert.type === 'info'
                        }"></i>
                    </div>
                    <div class="ml-3 w-0 flex-1 pt-0.5">
                        <p class="text-sm font-medium text-white" x-text="alert.message"></p>
                    </div>
                    <div class="ml-4 flex-shrink-0 flex">
                        <button @click="alert.show = false" class="text-gray-400 hover:text-gray-200">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function assetsManager() {
            return {
                activeTab: 'intros',
                assets: {
                    intros: {{ intros | tojson }},
                    outros: {{ outros | tojson }},
                    logos: {{ logos | tojson }}
                },
                uploadForm: {
                    assetType: 'intros',
                    selectedFile: null
                },
                isUploading: false,
                alert: {
                    show: false,
                    type: 'info',
                    message: ''
                },

                handleFileSelect(event) {
                    this.uploadForm.selectedFile = event.target.files[0];
                },

                async uploadAsset() {
                    if (!this.uploadForm.selectedFile) {
                        this.showAlert('error', 'Please select a file first');
                        return;
                    }

                    this.isUploading = true;
                    
                    try {
                        const formData = new FormData();
                        formData.append('file', this.uploadForm.selectedFile);
                        formData.append('asset_type', this.uploadForm.assetType);

                        const response = await fetch('/upload-asset', {
                            method: 'POST',
                            body: formData
                        });

                        const result = await response.json();

                        if (response.ok) {
                            this.showAlert('success', result.message);
                            await this.refreshAssets();
                            this.uploadForm.selectedFile = null;
                            this.$refs.fileInput.value = '';
                        } else {
                            this.showAlert('error', result.detail || 'Upload failed');
                        }
                    } catch (error) {
                        console.error('Upload error:', error);
                        this.showAlert('error', 'Network error occurred');
                    } finally {
                        this.isUploading = false;
                    }
                },

                async deleteAsset(assetType, filename) {
                    if (!confirm(`Are you sure you want to delete ${filename}?`)) {
                        return;
                    }

                    try {
                        const response = await fetch(`/delete-asset/${assetType}/${encodeURIComponent(filename)}`, {
                            method: 'DELETE'
                        });

                        const result = await response.json();

                        if (response.ok) {
                            this.showAlert('success', result.message);
                            await this.refreshAssets();
                        } else {
                            this.showAlert('error', result.detail || 'Delete failed');
                        }
                    } catch (error) {
                        console.error('Delete error:', error);
                        this.showAlert('error', 'Network error occurred');
                    }
                },

                async refreshAssets() {
                    try {
                        const [introsRes, outrosRes, logosRes] = await Promise.all([
                            fetch('/api/assets/intros'),
                            fetch('/api/assets/outros'),
                            fetch('/api/assets/logos')
                        ]);

                        if (introsRes.ok) {
                            const introsData = await introsRes.json();
                            this.assets.intros = introsData.assets || [];
                        }

                        if (outrosRes.ok) {
                            const outrosData = await outrosRes.json();
                            this.assets.outros = outrosData.assets || [];
                        }

                        if (logosRes.ok) {
                            const logosData = await logosRes.json();
                            this.assets.logos = logosData.assets || [];
                        }
                    } catch (error) {
                        console.error('Failed to refresh assets:', error);
                    }
                },

                formatFileSize(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                },

                formatDate(dateString) {
                    return new Date(dateString).toLocaleDateString() + ' ' + new Date(dateString).toLocaleTimeString();
                },

                showAlert(type, message) {
                    this.alert = { show: true, type, message };
                    setTimeout(() => {
                        this.alert.show = false;
                    }, 5000);
                }
            };
        }
    </script>
</body>
</html>